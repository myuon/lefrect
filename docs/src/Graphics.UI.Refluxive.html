<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
  Refluxive framework
-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings, GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-6"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Graphics.UI.Refluxive</span><span>
</span><a name="line-7"></a><span>  </span><span class="hs-special">(</span><span>
</span><a name="line-8"></a><span>  </span><span class="hs-comment">-- * UI monad</span><span>
</span><a name="line-9"></a><span>  </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span>
</span><a name="line-10"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#runUI"><span class="hs-identifier hs-var">runUI</span></a><span>
</span><a name="line-11"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#mainloop"><span class="hs-identifier hs-var">mainloop</span></a><span>
</span><a name="line-12"></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#register"><span class="hs-identifier hs-var">register</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#emit"><span class="hs-identifier hs-var">emit</span></a><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#watch"><span class="hs-identifier hs-var">watch</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#asRoot"><span class="hs-identifier hs-var">asRoot</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#setClearColor"><span class="hs-identifier hs-var">setClearColor</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#addWatchSignal"><span class="hs-identifier hs-var">addWatchSignal</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#quit"><span class="hs-identifier hs-var">quit</span></a><span>
</span><a name="line-20"></a><span>
</span><a name="line-21"></a><span>  </span><span class="hs-comment">-- * Component</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span>  </span><span class="hs-comment">-- ** Raw Component</span><span>
</span><a name="line-24"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-25"></a><span>  </span><span class="hs-comment">-- | Raw component is a component of static picture with no signal</span><span>
</span><a name="line-26"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-27"></a><span>  </span><span class="hs-comment">-- @Component UI &quot;raw&quot;@ has Graphical value as model</span><span>
</span><a name="line-28"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#rawGraphical"><span class="hs-identifier hs-var">rawGraphical</span></a><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span>  </span><span class="hs-comment">-- ** Built-in Component</span><span>
</span><a name="line-31"></a><span>  </span><span class="hs-comment">--</span><span>
</span><a name="line-32"></a><span>  </span><span class="hs-comment">-- | Built-in component is a component which emits SDL events as 'BuiltInSignal'</span><span>
</span><a name="line-33"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#_builtIn"><span class="hs-identifier hs-var">_builtIn</span></a><span>
</span><a name="line-34"></a><span>
</span><a name="line-35"></a><span>  </span><span class="hs-comment">-- * Component types</span><span>
</span><a name="line-36"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-37"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span>
</span><a name="line-38"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Watcher"><span class="hs-identifier hs-type">Watcher</span></a><span>
</span><a name="line-39"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#getModel"><span class="hs-identifier hs-var">getModel</span></a><span>
</span><a name="line-40"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-41"></a><span>
</span><a name="line-42"></a><span>  </span><span class="hs-comment">-- * Operations on component</span><span>
</span><a name="line-43"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#new"><span class="hs-identifier hs-var">new</span></a><span>
</span><a name="line-44"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#view"><span class="hs-identifier hs-var">view</span></a><span>
</span><a name="line-45"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#operateModel"><span class="hs-identifier hs-var">operateModel</span></a><span>
</span><a name="line-46"></a><span>
</span><a name="line-47"></a><span>  </span><span class="hs-comment">-- * Re-exports</span><span>
</span><a name="line-48"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><a href="Graphics.UI.Refluxive.Graphical.html"><span class="hs-identifier">Graphics.UI.Refluxive.Graphical</span></a><span>
</span><a name="line-49"></a><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Default</span><span>
</span><a name="line-50"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-51"></a><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">SDL</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">SDL</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">SDL.Font</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">SDLF</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent.MVar</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Lens</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">view</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.State</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Cont</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.IORef</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Unique</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Vector.Mutable</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">V</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.IntSet</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Default</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Word</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Word8</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Linear.V4</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Unsafe.Coerce</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span> </span><a href="Graphics.UI.Refluxive.Graphical.html"><span class="hs-identifier">Graphics.UI.Refluxive.Graphical</span></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><a href="Graphics.UI.Refluxive.Component.html"><span class="hs-identifier">Graphics.UI.Refluxive.Component</span></a><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><span class="hs-keyword">data</span><span> </span><a name="Registry"><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier">Registry</span></a></a><span> </span><a name="local-6989586621679123437"><a href="#local-6989586621679123437"><span class="hs-identifier">a</span></a></a><span>
</span><a name="line-71"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="Registry"><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier">Registry</span></a></a><span>
</span><a name="line-72"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="_content"><a href="Graphics.UI.Refluxive.html#_content"><span class="hs-identifier">_content</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">V.IOVector</span><span> </span><a href="#local-6989586621679123437"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-73"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_keys"><a href="Graphics.UI.Refluxive.html#_keys"><span class="hs-identifier">_keys</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">S.IntSet</span><span>
</span><a name="line-74"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_uids"><a href="Graphics.UI.Refluxive.html#_uids"><span class="hs-identifier">_uids</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">M.Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-75"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-76"></a><span>
</span><a name="line-77"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">Registry</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-identifier">newRegistry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-type">Registry</span></a><span> </span><a href="#local-6989586621679124480"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-80"></a><a name="newRegistry"><a href="Graphics.UI.Refluxive.html#newRegistry"><span class="hs-identifier">newRegistry</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-81"></a><span>  </span><a name="local-6989586621679124481"><a href="#local-6989586621679124481"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">V.new</span><span> </span><span class="hs-number">20</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-var">Registry</span></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_content</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679124481"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_keys</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">S.empty</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_uids</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">M.empty</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-88"></a><span>
</span><a name="line-89"></a><span class="hs-identifier">pushRegistry</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124479"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-type">Registry</span></a><span> </span><a href="#local-6989586621679124479"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-type">Registry</span></a><span> </span><a href="#local-6989586621679124479"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><a name="pushRegistry"><a href="Graphics.UI.Refluxive.html#pushRegistry"><span class="hs-identifier">pushRegistry</span></a></a><span> </span><a name="local-6989586621679124482"><a href="#local-6989586621679124482"><span class="hs-identifier">name</span></a></a><span> </span><a name="local-6989586621679124483"><a href="#local-6989586621679124483"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679124484"><a href="#local-6989586621679124484"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">`</span><span class="hs-identifier">runContT</span><span class="hs-special">`</span><span> </span><span class="hs-identifier hs-var">return</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">callCC</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679124661"><a href="#local-6989586621679124661"><span class="hs-identifier">return_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-91"></a><span>  </span><span class="hs-identifier hs-var">forM_</span><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-identifier hs-var">V.length</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679124694"><a href="#local-6989586621679124694"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124694"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">S.notMember</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#keys"><span class="hs-identifier hs-var">keys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-93"></a><span>      </span><span class="hs-identifier hs-var">V.write</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124694"><span class="hs-identifier hs-var">i</span></a><span> </span><a href="#local-6989586621679124483"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-94"></a><span>      </span><a href="#local-6989586621679124661"><span class="hs-identifier hs-var">return_</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124694"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="Graphics.UI.Refluxive.html#keys"><span class="hs-identifier hs-var">keys</span></a><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-identifier hs-var">S.insert</span><span> </span><a href="#local-6989586621679124694"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="Graphics.UI.Refluxive.html#uids"><span class="hs-identifier hs-var">uids</span></a><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-identifier hs-var">M.insert</span><span> </span><a href="#local-6989586621679124482"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679124694"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679124786"><a href="#local-6989586621679124786"><span class="hs-identifier">length</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">V.length</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>  </span><a name="local-6989586621679124787"><a href="#local-6989586621679124787"><span class="hs-identifier">content'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.grow</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">20</span><span>
</span><a name="line-98"></a><span>  </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.write</span><span> </span><a href="#local-6989586621679124787"><span class="hs-identifier hs-var">content'</span></a><span> </span><a href="#local-6989586621679124786"><span class="hs-identifier hs-var">length</span></a><span> </span><a href="#local-6989586621679124483"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-99"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124786"><span class="hs-identifier hs-var">length</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679124484"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span> </span><span class="hs-operator hs-var">.~</span><span> </span><a href="#local-6989586621679124787"><span class="hs-identifier hs-var">content'</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="Graphics.UI.Refluxive.html#keys"><span class="hs-identifier hs-var">keys</span></a><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-identifier hs-var">S.insert</span><span> </span><a href="#local-6989586621679124786"><span class="hs-identifier hs-var">length</span></a><span> </span><span class="hs-operator hs-var">&amp;</span><span> </span><a href="Graphics.UI.Refluxive.html#uids"><span class="hs-identifier hs-var">uids</span></a><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-identifier hs-var">M.insert</span><span> </span><a href="#local-6989586621679124482"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679124786"><span class="hs-identifier hs-var">length</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-identifier">getRegistryByUID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679124477"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-type">Registry</span></a><span> </span><a href="#local-6989586621679124478"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124477"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679124478"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-102"></a><a name="getRegistryByUID"><a href="Graphics.UI.Refluxive.html#getRegistryByUID"><span class="hs-identifier">getRegistryByUID</span></a></a><span> </span><a name="local-6989586621679124788"><a href="#local-6989586621679124788"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-6989586621679124789"><a href="#local-6989586621679124789"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-103"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124788"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">M.notMember</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124789"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#uids"><span class="hs-identifier hs-var">uids</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Unexpected name: &quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679124788"><span class="hs-identifier hs-var">uid</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;, you might forget registering the ComponentView?&quot;</span><span>
</span><a name="line-104"></a><span>  </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.read</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124789"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124789"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#uids"><span class="hs-identifier hs-var">uids</span></a><span> </span><span class="hs-operator hs-var">^?!</span><span> </span><span class="hs-identifier hs-var">ix</span><span> </span><a href="#local-6989586621679124788"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">)</span><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-identifier">modifyMRegistryByUID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679124475"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-type">Registry</span></a><span> </span><a href="#local-6989586621679124476"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124476"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124475"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679124476"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124475"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><a name="modifyMRegistryByUID"><a href="Graphics.UI.Refluxive.html#modifyMRegistryByUID"><span class="hs-identifier">modifyMRegistryByUID</span></a></a><span> </span><a name="local-6989586621679124947"><a href="#local-6989586621679124947"><span class="hs-identifier">uid</span></a></a><span> </span><a name="local-6989586621679124948"><a href="#local-6989586621679124948"><span class="hs-identifier">reg</span></a></a><span> </span><a name="local-6989586621679124949"><a href="#local-6989586621679124949"><span class="hs-identifier">updater</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-108"></a><span>  </span><a name="local-6989586621679124950"><a href="#local-6989586621679124950"><span class="hs-identifier">current</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.html#getRegistryByUID"><span class="hs-identifier hs-var">getRegistryByUID</span></a><span> </span><a href="#local-6989586621679124947"><span class="hs-identifier hs-var">uid</span></a><span> </span><a href="#local-6989586621679124948"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-109"></a><span>  </span><a name="local-6989586621679124951"><a href="#local-6989586621679124951"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679124949"><span class="hs-identifier hs-var">updater</span></a><span> </span><a href="#local-6989586621679124950"><span class="hs-identifier hs-var">current</span></a><span>
</span><a name="line-110"></a><span>  </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.write</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124948"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679124948"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#uids"><span class="hs-identifier hs-var">uids</span></a><span> </span><span class="hs-operator hs-var">^?!</span><span> </span><span class="hs-identifier hs-var">ix</span><span> </span><a href="#local-6989586621679124947"><span class="hs-identifier hs-var">uid</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679124951"><span class="hs-identifier hs-var">next</span></a><span>
</span><a name="line-111"></a><span>
</span><a name="line-112"></a><span class="hs-keyword">data</span><span> </span><a name="SomeSignal"><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier">SomeSignal</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679124469"><a href="#local-6989586621679124469"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679124469"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="SomeSignal"><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier">SomeSignal</span></a></a><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679124469"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span class="hs-keyword">newtype</span><span> </span><a name="EventStream"><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier">EventStream</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EventStream"><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier">EventStream</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getEventStream"><a href="Graphics.UI.Refluxive.html#getEventStream"><span class="hs-identifier">getEventStream</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MVar</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier hs-type">SomeSignal</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-114"></a><span>
</span><a name="line-115"></a><span class="hs-identifier">newEventStream</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679124474"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679124474"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier hs-type">EventStream</span></a><span>
</span><a name="line-116"></a><a name="newEventStream"><a href="Graphics.UI.Refluxive.html#newEventStream"><span class="hs-identifier">newEventStream</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier hs-var">EventStream</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">newMVar</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-identifier">pushEvent</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679124472"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679124473"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier hs-type">EventStream</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679124472"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679124472"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124473"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><a name="pushEvent"><a href="Graphics.UI.Refluxive.html#pushEvent"><span class="hs-identifier">pushEvent</span></a></a><span> </span><a name="local-6989586621679124952"><a href="#local-6989586621679124952"><span class="hs-identifier">stream</span></a></a><span> </span><a name="local-6989586621679124953"><a href="#local-6989586621679124953"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679124954"><a href="#local-6989586621679124954"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">modifyMVar_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getEventStream</span><span> </span><a href="#local-6989586621679124952"><span class="hs-identifier hs-var">stream</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#makeEvent"><span class="hs-identifier hs-var">makeEvent</span></a><span> </span><a href="#local-6989586621679124953"><span class="hs-identifier hs-var">cp</span></a><span> </span><a href="#local-6989586621679124954"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-identifier">makeEvent</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679124471"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679124471"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679124471"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier hs-type">SomeSignal</span></a><span class="hs-special">)</span><span>
</span><a name="line-122"></a><a name="makeEvent"><a href="Graphics.UI.Refluxive.html#makeEvent"><span class="hs-identifier">makeEvent</span></a></a><span> </span><a name="local-6989586621679124955"><a href="#local-6989586621679124955"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679124956"><a href="#local-6989586621679124956"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679124955"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier hs-var">SomeSignal</span></a><span> </span><a href="#local-6989586621679124956"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-identifier">pullEvents</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679124470"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier hs-type">EventStream</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679124470"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier hs-type">SomeSignal</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-125"></a><a name="pullEvents"><a href="Graphics.UI.Refluxive.html#pullEvents"><span class="hs-identifier">pullEvents</span></a></a><span> </span><a name="local-6989586621679124957"><a href="#local-6989586621679124957"><span class="hs-identifier">stream</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">reverse</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">swapMVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">getEventStream</span><span> </span><a href="#local-6989586621679124957"><span class="hs-identifier hs-var">stream</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | UI monad</span><span>
</span><a name="line-128"></a><span class="hs-keyword">newtype</span><span> </span><a name="UI"><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier">UI</span></a></a><span> </span><a name="local-6989586621679124407"><a href="#local-6989586621679124407"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="UI"><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier">UI</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="unpackUI"><a href="Graphics.UI.Refluxive.html#unpackUI"><span class="hs-identifier">unpackUI</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">StateT</span><span> </span><a href="Graphics.UI.Refluxive.html#UIState"><span class="hs-identifier hs-type">UIState</span></a><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679124407"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Applicative</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monad</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-keyword">data</span><span> </span><a name="SomeComponent"><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier">SomeComponent</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679124406"><a href="#local-6989586621679124406"><span class="hs-identifier">a</span></a></a><span class="hs-operator">.</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679124406"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="SomeComponent"><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier">SomeComponent</span></a></a><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679124406"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span class="hs-keyword">data</span><span> </span><a name="SomeCallback"><a href="Graphics.UI.Refluxive.html#SomeCallback"><span class="hs-identifier">SomeCallback</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679124404"><a href="#local-6989586621679124404"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679124405"><a href="#local-6989586621679124405"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679124404"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679124405"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="SomeCallback"><a href="Graphics.UI.Refluxive.html#SomeCallback"><span class="hs-identifier">SomeCallback</span></a></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Graphical.html#RenderState"><span class="hs-identifier hs-type">RenderState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679124404"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">StateT</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Model"><span class="hs-identifier hs-type">Model</span></a><span> </span><a href="#local-6989586621679124405"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-keyword">data</span><span> </span><a name="UIState"><a href="Graphics.UI.Refluxive.html#UIState"><span class="hs-identifier">UIState</span></a></a><span>
</span><a name="line-134"></a><span>  </span><span class="hs-glyph">=</span><span> </span><a name="UIState"><a href="Graphics.UI.Refluxive.html#UIState"><span class="hs-identifier">UIState</span></a></a><span>
</span><a name="line-135"></a><span>  </span><span class="hs-special">{</span><span> </span><a name="_renderer"><a href="Graphics.UI.Refluxive.html#_renderer"><span class="hs-identifier">_renderer</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDL.Renderer</span><span>
</span><a name="line-136"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_registry"><a href="Graphics.UI.Refluxive.html#_registry"><span class="hs-identifier">_registry</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.html#Registry"><span class="hs-identifier hs-type">Registry</span></a><span> </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-type">SomeComponent</span></a><span>
</span><a name="line-137"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_eventStream"><a href="Graphics.UI.Refluxive.html#_eventStream"><span class="hs-identifier">_eventStream</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.html#EventStream"><span class="hs-identifier hs-type">EventStream</span></a><span>
</span><a name="line-138"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_distributer"><a href="Graphics.UI.Refluxive.html#_distributer"><span class="hs-identifier">_distributer</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">M.Map</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-special">[</span><a href="Graphics.UI.Refluxive.html#SomeCallback"><span class="hs-identifier hs-type">SomeCallback</span></a><span class="hs-special">]</span><span>
</span><a name="line-139"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_font"><a href="Graphics.UI.Refluxive.html#_font"><span class="hs-identifier">_font</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">SDLF.Font</span><span>
</span><a name="line-140"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_clearColor"><a href="Graphics.UI.Refluxive.html#_clearColor"><span class="hs-identifier">_clearColor</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDLF.Color</span><span>
</span><a name="line-141"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_isQuit"><a href="Graphics.UI.Refluxive.html#_isQuit"><span class="hs-identifier">_isQuit</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-142"></a><span>  </span><span class="hs-special">,</span><span> </span><a name="_builtIn%27"><a href="Graphics.UI.Refluxive.html#_builtIn%27"><span class="hs-identifier">_builtIn'</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><span class="hs-string">&quot;builtin&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-special">}</span><span>
</span><a name="line-144"></a><span>
</span><a name="line-145"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">UIState</span><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-keyword">instance</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-string">&quot;builtin&quot;</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-148"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">ModelParam</span><span> </span><span class="hs-string">&quot;builtin&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-149"></a><span>  </span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Model</span><span> </span><span class="hs-string">&quot;builtin&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="BuiltInModel"><a href="Graphics.UI.Refluxive.html#BuiltInModel"><span class="hs-identifier">BuiltInModel</span></a></a><span>
</span><a name="line-150"></a><span>  </span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Signal</span><span> </span><span class="hs-string">&quot;builtin&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="BuiltInSignal"><a href="Graphics.UI.Refluxive.html#BuiltInSignal"><span class="hs-identifier">BuiltInSignal</span></a></a><span> </span><span class="hs-identifier hs-type">SDL.Event</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="TickSignal"><a href="Graphics.UI.Refluxive.html#TickSignal"><span class="hs-identifier">TickSignal</span></a></a><span>
</span><a name="line-151"></a><span>
</span><a name="line-152"></a><span>  </span><a name="local-8214565720323894829"><a href="Graphics.UI.Refluxive.Component.html#newModel"><span class="hs-identifier">newModel</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="Graphics.UI.Refluxive.html#BuiltInModel"><span class="hs-identifier hs-var">BuiltInModel</span></a><span>
</span><a name="line-153"></a><span>  </span><a name="local-8214565720323894831"><a href="Graphics.UI.Refluxive.Component.html#getGraphical"><span class="hs-identifier">getGraphical</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">error</span><span> </span><span class="hs-string">&quot;unimplemented&quot;</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">MonadState</span><span> </span><a href="Graphics.UI.Refluxive.html#UIState"><span class="hs-identifier hs-type">UIState</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-156"></a><span>  </span><a name="local-8214565720323785000"><span class="hs-identifier">state</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-var">UI</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">state</span><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Running UI monad</span><span>
</span><a name="line-159"></a><span class="hs-identifier">runUI</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><a name="runUI"><a href="Graphics.UI.Refluxive.html#runUI"><span class="hs-identifier">runUI</span></a></a><span> </span><a name="local-6989586621679131985"><a href="#local-6989586621679131985"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-161"></a><span>  </span><span class="hs-identifier hs-var">SDL.initializeAll</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-identifier hs-var">SDLF.initialize</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>  </span><span class="hs-identifier hs-var">evalStateT</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">unpackUI</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#initialize"><span class="hs-identifier hs-var">initialize</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679131985"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UIState"><span class="hs-identifier hs-var">UIState</span></a><span>
</span><a name="line-165"></a><span>    </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679131986"><a href="#local-6989586621679131986"><span class="hs-identifier">w</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">SDL.createRenderer</span><span> </span><a href="#local-6989586621679131986"><span class="hs-identifier hs-var">w</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">SDL.defaultRenderer</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><span class="hs-identifier hs-var">SDL.createWindow</span><span> </span><span class="hs-string">&quot;window&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SDL.defaultWindow</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">SDL.windowResizable</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#newRegistry"><span class="hs-identifier hs-var">newRegistry</span></a><span>
</span><a name="line-167"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#newEventStream"><span class="hs-identifier hs-var">newEventStream</span></a><span>
</span><a name="line-168"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">M.empty</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">SDLF.load</span><span> </span><span class="hs-string">&quot;/usr/share/fonts/opentype/noto/NotoSansCJK-Regular.ttc&quot;</span><span> </span><span class="hs-number">20</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">V4</span><span> </span><span class="hs-number">255</span><span> </span><span class="hs-number">255</span><span> </span><span class="hs-number">255</span><span> </span><span class="hs-number">255</span><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-comment">-- | Set background color</span><span>
</span><a name="line-175"></a><span class="hs-identifier">setClearColor</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">SDLF.Color</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-176"></a><a name="setClearColor"><a href="Graphics.UI.Refluxive.html#setClearColor"><span class="hs-identifier">setClearColor</span></a></a><span> </span><a name="local-6989586621679132001"><a href="#local-6989586621679132001"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-177"></a><span>  </span><a name="local-6989586621679132002"><a href="#local-6989586621679132002"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#renderer"><span class="hs-identifier hs-var">renderer</span></a><span>
</span><a name="line-178"></a><span>  </span><a href="Graphics.UI.Refluxive.html#clearColor"><span class="hs-identifier hs-var">clearColor</span></a><span> </span><span class="hs-operator hs-var">.=</span><span> </span><a href="#local-6989586621679132001"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-179"></a><span>  </span><span class="hs-identifier hs-var">SDL.rendererDrawColor</span><span> </span><a href="#local-6989586621679132002"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">SDL.$=</span><span> </span><a href="#local-6989586621679132001"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-180"></a><span>
</span><a name="line-181"></a><span class="hs-comment">-- | Register a ComponentView to refluxive framework</span><span>
</span><a name="line-182"></a><span class="hs-identifier">register</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131984"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131984"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-183"></a><a name="register"><a href="Graphics.UI.Refluxive.html#register"><span class="hs-identifier">register</span></a></a><span> </span><a name="local-6989586621679132003"><a href="#local-6989586621679132003"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-184"></a><span>  </span><a name="local-6989586621679132004"><a href="#local-6989586621679132004"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-185"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679132005"><a href="#local-6989586621679132005"><span class="hs-identifier">reg'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#pushRegistry"><span class="hs-identifier hs-var">pushRegistry</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679132003"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a href="#local-6989586621679132003"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132004"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-186"></a><span>  </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span> </span><span class="hs-operator hs-var">.=</span><span> </span><a href="#local-6989586621679132005"><span class="hs-identifier hs-var">reg'</span></a><span>
</span><a name="line-187"></a><span>
</span><a name="line-188"></a><span class="hs-comment">-- | Emit a signal from a component</span><span>
</span><a name="line-189"></a><span class="hs-identifier">emit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131983"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131983"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679131983"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><a name="emit"><a href="Graphics.UI.Refluxive.html#emit"><span class="hs-identifier">emit</span></a></a><span> </span><a name="local-6989586621679132006"><a href="#local-6989586621679132006"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679132007"><a href="#local-6989586621679132007"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#eventStream"><span class="hs-identifier hs-var">eventStream</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679132008"><a href="#local-6989586621679132008"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#pushEvent"><span class="hs-identifier hs-var">pushEvent</span></a><span> </span><a href="#local-6989586621679132008"><span class="hs-identifier hs-var">es</span></a><span> </span><a href="#local-6989586621679132006"><span class="hs-identifier hs-var">cp</span></a><span> </span><a href="#local-6989586621679132007"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span class="hs-identifier">clear</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-193"></a><a name="clear"><a href="Graphics.UI.Refluxive.html#clear"><span class="hs-identifier">clear</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-194"></a><span>  </span><a name="local-6989586621679132009"><a href="#local-6989586621679132009"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#renderer"><span class="hs-identifier hs-var">renderer</span></a><span>
</span><a name="line-195"></a><span>  </span><a name="local-6989586621679132010"><a href="#local-6989586621679132010"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#clearColor"><span class="hs-identifier hs-var">clearColor</span></a><span>
</span><a name="line-196"></a><span>  </span><span class="hs-identifier hs-var">SDL.rendererDrawColor</span><span> </span><a href="#local-6989586621679132009"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">SDL.$=</span><span> </span><a href="#local-6989586621679132010"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-197"></a><span>  </span><span class="hs-identifier hs-var">SDL.clear</span><span> </span><a href="#local-6989586621679132009"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-comment">-- | Quit the mainloop</span><span>
</span><a name="line-200"></a><span class="hs-identifier">quit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><a name="quit"><a href="Graphics.UI.Refluxive.html#quit"><span class="hs-identifier">quit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.html#isQuit"><span class="hs-identifier hs-var">isQuit</span></a><span> </span><span class="hs-operator hs-var">.=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-identifier">initialize</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><a name="initialize"><a href="Graphics.UI.Refluxive.html#initialize"><span class="hs-identifier">initialize</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-205"></a><span>  </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#clearColor"><span class="hs-identifier hs-var">clearColor</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Graphics.UI.Refluxive.html#setClearColor"><span class="hs-identifier hs-var">setClearColor</span></a><span>
</span><a name="line-206"></a><span>  </span><a name="local-6989586621679132011"><a href="#local-6989586621679132011"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.html#new"><span class="hs-identifier hs-var">new</span></a><span> </span><span class="hs-glyph">@</span><span class="hs-string">&quot;builtin&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>  </span><a href="Graphics.UI.Refluxive.html#builtIn%27"><span class="hs-identifier hs-var">builtIn'</span></a><span> </span><span class="hs-operator hs-var">.=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679132011"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-208"></a><span>  </span><a href="Graphics.UI.Refluxive.html#register"><span class="hs-identifier hs-var">register</span></a><span> </span><a href="#local-6989586621679132011"><span class="hs-identifier hs-var">b</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-comment">-- | A function which is used for passing to mainloop</span><span>
</span><a name="line-211"></a><span class="hs-identifier">asRoot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131982"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131982"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-type">SomeComponent</span></a><span>
</span><a name="line-212"></a><a name="asRoot"><a href="Graphics.UI.Refluxive.html#asRoot"><span class="hs-identifier">asRoot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-comment">-- | A lens to focus on builtIn component</span><span>
</span><a name="line-215"></a><span class="hs-identifier">_builtIn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Lens'</span><span> </span><a href="Graphics.UI.Refluxive.html#UIState"><span class="hs-identifier hs-type">UIState</span></a><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><span class="hs-string">&quot;builtin&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-216"></a><a name="_builtIn"><a href="Graphics.UI.Refluxive.html#_builtIn"><span class="hs-identifier">_builtIn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.html#builtIn%27"><span class="hs-identifier hs-var">builtIn'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">lens</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679132118"><a href="#local-6989586621679132118"><span class="hs-identifier">a</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679132118"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679132119"><a href="#local-6989586621679132119"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679132119"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span class="hs-comment">-- | Start a mainloop, render given components as root</span><span>
</span><a name="line-219"></a><span class="hs-identifier">mainloop</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-type">SomeComponent</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><a name="mainloop"><a href="Graphics.UI.Refluxive.html#mainloop"><span class="hs-identifier">mainloop</span></a></a><span> </span><a name="local-6989586621679132120"><a href="#local-6989586621679132120"><span class="hs-identifier">root</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-221"></a><span>  </span><span class="hs-comment">-- poll sdl events</span><span>
</span><a name="line-222"></a><span>  </span><span class="hs-identifier hs-var">SDL.pollEvents</span><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679132121"><a href="#local-6989586621679132121"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679132121"><span class="hs-identifier hs-var">evs</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679132122"><a href="#local-6989586621679132122"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-223"></a><span>    </span><a name="local-6989586621679132123"><a href="#local-6989586621679132123"><span class="hs-identifier">es</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#eventStream"><span class="hs-identifier hs-var">eventStream</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679132124"><a href="#local-6989586621679132124"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#builtIn%27"><span class="hs-identifier hs-var">builtIn'</span></a><span>
</span><a name="line-225"></a><span>
</span><a name="line-226"></a><span>    </span><a href="Graphics.UI.Refluxive.html#pushEvent"><span class="hs-identifier hs-var">pushEvent</span></a><span> </span><a href="#local-6989586621679132123"><span class="hs-identifier hs-var">es</span></a><span> </span><a href="#local-6989586621679132124"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#BuiltInSignal"><span class="hs-identifier hs-var">BuiltInSignal</span></a><span> </span><a href="#local-6989586621679132122"><span class="hs-identifier hs-var">ev</span></a><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span>  </span><span class="hs-comment">-- event handling</span><span>
</span><a name="line-229"></a><span>  </span><a name="local-6989586621679132125"><a href="#local-6989586621679132125"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#_builtIn"><span class="hs-identifier hs-var">_builtIn</span></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#eventStream"><span class="hs-identifier hs-var">eventStream</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="Graphics.UI.Refluxive.html#pullEvents"><span class="hs-identifier hs-var">pullEvents</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679132126"><a href="#local-6989586621679132126"><span class="hs-identifier">evs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">forM_</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#makeEvent"><span class="hs-identifier hs-var">makeEvent</span></a><span> </span><a href="#local-6989586621679132125"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="Graphics.UI.Refluxive.html#TickSignal"><span class="hs-identifier hs-var">TickSignal</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679132126"><span class="hs-identifier hs-var">evs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679132127"><a href="#local-6989586621679132127"><span class="hs-identifier">src</span></a></a><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.html#SomeSignal"><span class="hs-identifier hs-var">SomeSignal</span></a><span> </span><a name="local-6989586621679132128"><a href="#local-6989586621679132128"><span class="hs-identifier">signal</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-231"></a><span>    </span><a name="local-6989586621679132130"><a href="#local-6989586621679132130"><span class="hs-identifier">callbacks</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679132129"><a href="#local-6989586621679132129"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">M.member</span><span> </span><a href="#local-6989586621679132127"><span class="hs-identifier hs-var">src</span></a><span> </span><a href="#local-6989586621679132129"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679132129"><span class="hs-identifier hs-var">d</span></a><span> </span><span class="hs-operator hs-var">M.!</span><span> </span><a href="#local-6989586621679132127"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#distributer"><span class="hs-identifier hs-var">distributer</span></a><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>    </span><a name="local-6989586621679132131"><a href="#local-6989586621679132131"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-234"></a><span>    </span><span class="hs-identifier hs-var">forM_</span><span> </span><a href="#local-6989586621679132130"><span class="hs-identifier hs-var">callbacks</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#SomeCallback"><span class="hs-identifier hs-var">SomeCallback</span></a><span> </span><a name="local-6989586621679132132"><a href="#local-6989586621679132132"><span class="hs-identifier">tgt</span></a></a><span> </span><a name="local-6989586621679132133"><a href="#local-6989586621679132133"><span class="hs-identifier">cb</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-235"></a><span>      </span><a href="Graphics.UI.Refluxive.html#getRegistryByUID"><span class="hs-identifier hs-var">getRegistryByUID</span></a><span> </span><a href="#local-6989586621679132132"><span class="hs-identifier hs-var">tgt</span></a><span> </span><a href="#local-6989586621679132131"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-236"></a><span>        </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a name="local-6989586621679132134"><a href="#local-6989586621679132134"><span class="hs-identifier">cp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-237"></a><span>          </span><a name="local-6989586621679132135"><a href="#local-6989586621679132135"><span class="hs-identifier">rs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">readIORef</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier">renderStateRef</span><span> </span><a href="#local-6989586621679132134"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-238"></a><span>          </span><a name="local-6989586621679132136"><a href="#local-6989586621679132136"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#getModel"><span class="hs-identifier hs-var">getModel</span></a><span> </span><a href="#local-6989586621679132134"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-239"></a><span>          </span><a name="local-6989586621679132137"><a href="#local-6989586621679132137"><span class="hs-identifier">model'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier hs-var">execStateT</span><span> </span><a href="#local-6989586621679132136"><span class="hs-identifier hs-var">model</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><a href="#local-6989586621679132133"><span class="hs-identifier hs-var">cb</span></a><span> </span><a href="#local-6989586621679132135"><span class="hs-identifier hs-var">rs</span></a><span> </span><a href="#local-6989586621679132128"><span class="hs-identifier hs-var">signal</span></a><span>
</span><a name="line-240"></a><span>          </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">writeIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">modelRef</span><span> </span><a href="#local-6989586621679132134"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132137"><span class="hs-identifier hs-var">model'</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>  </span><span class="hs-comment">-- clear</span><span>
</span><a name="line-243"></a><span>  </span><a href="Graphics.UI.Refluxive.html#clear"><span class="hs-identifier hs-var">clear</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>  </span><span class="hs-comment">-- render root component</span><span>
</span><a name="line-246"></a><span>  </span><a name="local-6989586621679132138"><a href="#local-6989586621679132138"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-247"></a><span>  </span><span class="hs-identifier hs-var">forM_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a name="local-6989586621679132139"><a href="#local-6989586621679132139"><span class="hs-identifier">cp</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132138"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#uids"><span class="hs-identifier hs-var">uids</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">M.!</span><span> </span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679132139"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132120"><span class="hs-identifier hs-var">root</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679132140"><a href="#local-6989586621679132140"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-248"></a><span>    </span><a name="local-6989586621679132141"><a href="#local-6989586621679132141"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-249"></a><span>    </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a name="local-6989586621679132142"><a href="#local-6989586621679132142"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">V.read</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132141"><span class="hs-identifier hs-var">reg</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><a href="Graphics.UI.Refluxive.html#content"><span class="hs-identifier hs-var">content</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132140"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-250"></a><span>
</span><a name="line-251"></a><span>    </span><a name="local-6989586621679132143"><a href="#local-6989586621679132143"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#renderer"><span class="hs-identifier hs-var">renderer</span></a><span>
</span><a name="line-252"></a><span>    </span><a name="local-6989586621679132144"><a href="#local-6989586621679132144"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#font"><span class="hs-identifier hs-var">font</span></a><span>
</span><a name="line-253"></a><span>    </span><a name="local-6989586621679132145"><a href="#local-6989586621679132145"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#clearColor"><span class="hs-identifier hs-var">clearColor</span></a><span>
</span><a name="line-254"></a><span>    </span><a name="local-6989586621679132146"><a href="#local-6989586621679132146"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.html#view"><span class="hs-identifier hs-var">view</span></a><span> </span><a href="#local-6989586621679132142"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-255"></a><span>    </span><a href="Graphics.UI.Refluxive.Graphical.html#render"><span class="hs-identifier hs-var">render</span></a><span> </span><a href="#local-6989586621679132145"><span class="hs-identifier hs-var">c</span></a><span> </span><a href="#local-6989586621679132144"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679132143"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679132146"><span class="hs-identifier hs-var">g</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679132147"><a href="#local-6989586621679132147"><span class="hs-identifier">st</span></a></a><span> </span><a name="local-6989586621679132148"><a href="#local-6989586621679132148"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-256"></a><span>      </span><a name="local-6989586621679132149"><a href="#local-6989586621679132149"><span class="hs-identifier">reg</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-257"></a><span>      </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a name="local-6989586621679132150"><a href="#local-6989586621679132150"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.html#getRegistryByUID"><span class="hs-identifier hs-var">getRegistryByUID</span></a><span> </span><a href="#local-6989586621679132148"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679132149"><span class="hs-identifier hs-var">reg</span></a><span>
</span><a name="line-258"></a><span>      </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">writeIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">renderStateRef</span><span> </span><a href="#local-6989586621679132150"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132147"><span class="hs-identifier hs-var">st</span></a><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span>  </span><span class="hs-comment">-- commit view changes</span><span>
</span><a name="line-261"></a><span>  </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#renderer"><span class="hs-identifier hs-var">renderer</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">SDL.present</span><span>
</span><a name="line-262"></a><span>
</span><a name="line-263"></a><span>  </span><span class="hs-comment">-- wait</span><span>
</span><a name="line-264"></a><span>  </span><span class="hs-identifier hs-var">SDL.delay</span><span> </span><span class="hs-number">33</span><span>
</span><a name="line-265"></a><span>
</span><a name="line-266"></a><span>  </span><a name="local-6989586621679132151"><a href="#local-6989586621679132151"><span class="hs-identifier">q</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#isQuit"><span class="hs-identifier hs-var">isQuit</span></a><span>
</span><a name="line-267"></a><span>  </span><span class="hs-identifier hs-var">unless</span><span> </span><a href="#local-6989586621679132151"><span class="hs-identifier hs-var">q</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#mainloop"><span class="hs-identifier hs-var">mainloop</span></a><span> </span><a href="#local-6989586621679132120"><span class="hs-identifier hs-var">root</span></a><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span>  </span><span class="hs-identifier hs-var">SDLF.quit</span><span>
</span><a name="line-270"></a><span>  </span><span class="hs-identifier hs-var">SDL.quit</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">-- | Watcher function</span><span>
</span><a name="line-273"></a><span class="hs-identifier">watch</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131980"><span class="hs-identifier hs-type">src</span></a><span class="hs-special">,</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131981"><span class="hs-identifier hs-type">tgt</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131980"><span class="hs-identifier hs-type">src</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Graphical.html#RenderState"><span class="hs-identifier hs-type">RenderState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Signal"><span class="hs-identifier hs-type">Signal</span></a><span> </span><a href="#local-6989586621679131980"><span class="hs-identifier hs-type">src</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">StateT</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Model"><span class="hs-identifier hs-type">Model</span></a><span> </span><a href="#local-6989586621679131981"><span class="hs-identifier hs-type">tgt</span></a><span class="hs-special">)</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Watcher"><span class="hs-identifier hs-type">Watcher</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131981"><span class="hs-identifier hs-type">tgt</span></a><span>
</span><a name="line-274"></a><a name="watch"><a href="Graphics.UI.Refluxive.html#watch"><span class="hs-identifier">watch</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Watcher"><span class="hs-identifier hs-var">Watcher</span></a><span>
</span><a name="line-275"></a><span>
</span><a name="line-276"></a><span class="hs-comment">-- | Add a watch signal</span><span>
</span><a name="line-277"></a><span class="hs-identifier">addWatchSignal</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131979"><span class="hs-identifier hs-type">tgt</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131979"><span class="hs-identifier hs-type">tgt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Watcher"><span class="hs-identifier hs-type">Watcher</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131979"><span class="hs-identifier hs-type">tgt</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-278"></a><a name="addWatchSignal"><a href="Graphics.UI.Refluxive.html#addWatchSignal"><span class="hs-identifier">addWatchSignal</span></a></a><span> </span><a name="local-6989586621679132219"><a href="#local-6989586621679132219"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679132220"><a href="#local-6989586621679132220"><span class="hs-identifier">w</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Watcher"><span class="hs-identifier hs-var">Watcher</span></a><span> </span><a name="local-6989586621679132221"><a href="#local-6989586621679132221"><span class="hs-identifier">srcCp</span></a></a><span> </span><a name="local-6989586621679132222"><a href="#local-6989586621679132222"><span class="hs-identifier">callback</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-279"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679132223"><a href="#local-6989586621679132223"><span class="hs-identifier">src</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679132221"><span class="hs-identifier hs-var">srcCp</span></a><span>
</span><a name="line-280"></a><span>  </span><a name="local-6989586621679132224"><a href="#local-6989586621679132224"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#distributer"><span class="hs-identifier hs-var">distributer</span></a><span>
</span><a name="line-281"></a><span>  </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679132223"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">M.notMember</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679132224"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#distributer"><span class="hs-identifier hs-var">distributer</span></a><span> </span><span class="hs-operator hs-var">%=</span><span> </span><span class="hs-identifier hs-var">M.insert</span><span> </span><a href="#local-6989586621679132223"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-282"></a><span>  </span><a href="Graphics.UI.Refluxive.html#distributer"><span class="hs-identifier hs-var">distributer</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">ix</span><span> </span><a href="#local-6989586621679132223"><span class="hs-identifier hs-var">src</span></a><span> </span><span class="hs-operator hs-var">%=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#SomeCallback"><span class="hs-identifier hs-var">SomeCallback</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679132219"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679132222"><span class="hs-identifier hs-var">callback</span></a><span class="hs-special">)</span><span>
</span><a name="line-283"></a><span>
</span><a name="line-284"></a><span class="hs-keyword">instance</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-string">&quot;raw&quot;</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-285"></a><span>  </span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Model</span><span> </span><span class="hs-string">&quot;raw&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><a name="RawModel"><a href="Graphics.UI.Refluxive.html#RawModel"><span class="hs-identifier">RawModel</span></a></a><span> </span><a href="Graphics.UI.Refluxive.Graphical.html#Graphical"><span class="hs-identifier hs-type">Graphical</span></a><span>
</span><a name="line-286"></a><span>  </span><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">ModelParam</span><span> </span><span class="hs-string">&quot;raw&quot;</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><span>  </span><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Signal</span><span> </span><span class="hs-string">&quot;raw&quot;</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span>  </span><a name="local-8214565720323894829"><a href="Graphics.UI.Refluxive.Component.html#newModel"><span class="hs-identifier">newModel</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.html#RawModel"><span class="hs-identifier hs-var">RawModel</span></a><span> </span><a href="Graphics.UI.Refluxive.Graphical.html#empty"><span class="hs-identifier hs-var">empty</span></a><span>
</span><a name="line-290"></a><span>
</span><a name="line-291"></a><span>  </span><a name="local-8214565720323894831"><a href="Graphics.UI.Refluxive.Component.html#getGraphical"><span class="hs-identifier">getGraphical</span></a></a><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#RawModel"><span class="hs-identifier hs-var">RawModel</span></a><span> </span><a name="local-6989586621679131973"><a href="#local-6989586621679131973"><span class="hs-identifier">g</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679131973"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | Register a graphical object to raw component</span><span>
</span><a name="line-294"></a><span class="hs-comment">-- | This will override the previous graphical</span><span>
</span><a name="line-295"></a><span class="hs-identifier">rawGraphical</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><span class="hs-string">&quot;raw&quot;</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Graphical.html#Graphical"><span class="hs-identifier hs-type">Graphical</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-296"></a><a name="rawGraphical"><a href="Graphics.UI.Refluxive.html#rawGraphical"><span class="hs-identifier">rawGraphical</span></a></a><span> </span><a name="local-6989586621679132225"><a href="#local-6989586621679132225"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679132226"><a href="#local-6989586621679132226"><span class="hs-identifier">g</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.html#operateModel"><span class="hs-identifier hs-var">operateModel</span></a><span> </span><a href="#local-6989586621679132225"><span class="hs-identifier hs-var">cp</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">modify</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.html#RawModel"><span class="hs-identifier hs-var">RawModel</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#RawModel"><span class="hs-identifier hs-var">RawModel</span></a><span> </span><a href="#local-6989586621679132226"><span class="hs-identifier hs-var">g</span></a><span>
</span><a name="line-297"></a><span>
</span><a name="line-298"></a><span class="hs-identifier">fromModel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131978"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Model"><span class="hs-identifier hs-type">Model</span></a><span> </span><a href="#local-6989586621679131978"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131978"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-299"></a><a name="fromModel"><a href="Graphics.UI.Refluxive.html#fromModel"><span class="hs-identifier">fromModel</span></a></a><span> </span><a name="local-6989586621679132227"><a href="#local-6989586621679132227"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-300"></a><span>  </span><a name="local-6989586621679132228"><a href="#local-6989586621679132228"><span class="hs-identifier">uniq</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-identifier hs-var">newUnique</span><span>
</span><a name="line-301"></a><span>  </span><a name="local-6989586621679132229"><a href="#local-6989586621679132229"><span class="hs-identifier">modelRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><a href="#local-6989586621679132227"><span class="hs-identifier hs-var">model</span></a><span>
</span><a name="line-302"></a><span>  </span><a name="local-6989586621679132230"><a href="#local-6989586621679132230"><span class="hs-identifier">renderRef</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">newIORef</span><span> </span><span class="hs-identifier hs-var">def</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-var">ComponentView</span></a><span>
</span><a name="line-305"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#prefix"><span class="hs-identifier hs-var">prefix</span></a><span> </span><a href="#local-6989586621679132227"><span class="hs-identifier hs-var">model</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">hashUnique</span><span> </span><a href="#local-6989586621679132228"><span class="hs-identifier hs-var">uniq</span></a><span class="hs-special">)</span><span>
</span><a name="line-306"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">renderStateRef</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679132230"><span class="hs-identifier hs-var">renderRef</span></a><span>
</span><a name="line-307"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">modelRef</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679132229"><span class="hs-identifier hs-var">modelRef</span></a><span>
</span><a name="line-308"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-309"></a><span>
</span><a name="line-310"></a><span class="hs-comment">-- | Get the view with current snapshot of model</span><span>
</span><a name="line-311"></a><span class="hs-identifier">view</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131977"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131977"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="Graphics.UI.Refluxive.Graphical.html#Graphical"><span class="hs-identifier hs-type">Graphical</span></a><span>
</span><a name="line-312"></a><a name="view"><a href="Graphics.UI.Refluxive.html#view"><span class="hs-identifier">view</span></a></a><span> </span><a name="local-6989586621679133042"><a href="#local-6989586621679133042"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-313"></a><span>  </span><a name="local-6989586621679133043"><a href="#local-6989586621679133043"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-314"></a><span>  </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a name="local-6989586621679133044"><a href="#local-6989586621679133044"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.html#getRegistryByUID"><span class="hs-identifier hs-var">getRegistryByUID</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679133042"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133043"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-315"></a><span>  </span><a name="local-6989586621679133045"><a href="#local-6989586621679133045"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#getModel"><span class="hs-identifier hs-var">getModel</span></a><span> </span><a href="#local-6989586621679133044"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-316"></a><span>  </span><a href="Graphics.UI.Refluxive.Graphical.html#viewInfo"><span class="hs-identifier hs-var">viewInfo</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679133044"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#getGraphical"><span class="hs-identifier hs-var">getGraphical</span></a><span> </span><a href="#local-6989586621679133045"><span class="hs-identifier hs-var">model</span></a><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-comment">-- | Modify internal model of a component</span><span>
</span><a name="line-319"></a><span class="hs-identifier">operateModel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131975"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131975"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">StateT</span><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#Model"><span class="hs-identifier hs-type">Model</span></a><span> </span><a href="#local-6989586621679131975"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131976"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131976"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-320"></a><a name="operateModel"><a href="Graphics.UI.Refluxive.html#operateModel"><span class="hs-identifier">operateModel</span></a></a><span> </span><a name="local-6989586621679133046"><a href="#local-6989586621679133046"><span class="hs-identifier">cp</span></a></a><span> </span><a name="local-6989586621679133047"><a href="#local-6989586621679133047"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-321"></a><span>  </span><a name="local-6989586621679133048"><a href="#local-6989586621679133048"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">use</span><span> </span><a href="Graphics.UI.Refluxive.html#registry"><span class="hs-identifier hs-var">registry</span></a><span>
</span><a name="line-322"></a><span>  </span><a href="Graphics.UI.Refluxive.html#getRegistryByUID"><span class="hs-identifier hs-var">getRegistryByUID</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">name</span><span> </span><a href="#local-6989586621679133046"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133048"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-323"></a><span>    </span><a href="Graphics.UI.Refluxive.html#SomeComponent"><span class="hs-identifier hs-var">SomeComponent</span></a><span> </span><a name="local-6989586621679133049"><a href="#local-6989586621679133049"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-324"></a><span>      </span><a name="local-6989586621679133050"><a href="#local-6989586621679133050"><span class="hs-identifier">model</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#getModel"><span class="hs-identifier hs-var">getModel</span></a><span> </span><a href="#local-6989586621679133049"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-325"></a><span>      </span><span class="hs-special">(</span><a name="local-6989586621679133051"><a href="#local-6989586621679133051"><span class="hs-identifier">result</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679133052"><a href="#local-6989586621679133052"><span class="hs-identifier">model'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><a href="#local-6989586621679133050"><span class="hs-identifier hs-var">model</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">unsafeCoerce</span><span> </span><a href="#local-6989586621679133047"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-326"></a><span>      </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">writeIORef</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">modelRef</span><span> </span><a href="#local-6989586621679133049"><span class="hs-identifier hs-var">cp</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679133052"><span class="hs-identifier hs-var">model'</span></a><span>
</span><a name="line-327"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679133051"><span class="hs-identifier hs-var">result</span></a><span>
</span><a name="line-328"></a><span>
</span><a name="line-329"></a><span class="hs-comment">-- | Constructor of a component</span><span>
</span><a name="line-330"></a><span class="hs-identifier">new</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#Component"><span class="hs-identifier hs-type">Component</span></a><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><a href="#local-6989586621679131974"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#ModelParam"><span class="hs-identifier hs-type">ModelParam</span></a><span> </span><a href="#local-6989586621679131974"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Graphics.UI.Refluxive.html#UI"><span class="hs-identifier hs-type">UI</span></a><span> </span><span class="hs-special">(</span><a href="Graphics.UI.Refluxive.Component.html#ComponentView"><span class="hs-identifier hs-type">ComponentView</span></a><span> </span><a href="#local-6989586621679131974"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><a name="new"><a href="Graphics.UI.Refluxive.html#new"><span class="hs-identifier">new</span></a></a><span> </span><a name="local-6989586621679133053"><a href="#local-6989586621679133053"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-332"></a><span>  </span><a name="local-6989586621679133054"><a href="#local-6989586621679133054"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Graphics.UI.Refluxive.html#fromModel"><span class="hs-identifier hs-var">fromModel</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span> </span><a href="Graphics.UI.Refluxive.Component.html#newModel"><span class="hs-identifier hs-var">newModel</span></a><span> </span><a href="#local-6989586621679133053"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-333"></a><span>  </span><a href="Graphics.UI.Refluxive.Component.html#initComponent"><span class="hs-identifier hs-var">initComponent</span></a><span> </span><a href="#local-6989586621679133054"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-334"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679133054"><span class="hs-identifier hs-var">cp</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a></pre></body></html>